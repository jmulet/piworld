define([],function(){
window.pw=window.pw||{};
(function(k,m){k.module("angular-clipboard",[]).factory("clipboard",["$document",function(a){return{copyText:function(b,d){var e=a[0].createElement("textarea");e.style.position="absolute";e.textContent=b;e.style.left="-10000px";d instanceof HTMLElement&&(e.style.top=d.getBoundingClientRect().top+"px");a[0].body.appendChild(e);try{a[0].body.style.webkitUserSelect="initial";var c=a[0].getSelection();c.removeAllRanges();e.select();if(!a[0].execCommand("copy"))throw"failure copy";c.removeAllRanges()}finally{a[0].body.style.webkitUserSelect=
""}a[0].body.removeChild(e)},supported:"queryCommandSupported"in document&&document.queryCommandSupported("copy")}}]).directive("clipboard",["clipboard",function(a){return{restrict:"A",scope:{onCopied:"&",onError:"&",text:"=",supported:"=?"},link:function(b,d){b.supported=a.supported;d.on("click",function(e){try{a.copyText(b.text,d[0]),k.isFunction(b.onCopied)&&b.$evalAsync(b.onCopied())}catch(c){k.isFunction(b.onError)&&b.$evalAsync(b.onError({err:c}))}})}}}]);var a=k.module("piWorld","ngSanitize ngCookies ui.router ui.bootstrap angular-growl pascalprecht.translate angular-clipboard oc.lazyLoad".split(" ")).constant("CONFIG",
{restURL:"",NODE_PORT:3E3,SERVERIP:m.pw.DEBUG?"192.168.1.44:3000":"https://piworld.es"}).constant("USER_ROLES",{admin:0,teacher:100,teacherNonEditing:105,teacheradmin:110,student:200,guest:300,undefined:400,parents:500}).constant("AVAILABLE",{groups:"1 ESO;2 ESO;3 ESO;4 ESO;1 BAT;1 BATCS;2 BAT;2 BATCS".split(";"),groupsStar:"*;1 ESO;2 ESO;3 ESO;4 ESO;1 BAT;1 BATCS;2 BAT;2 BATCS".split(";"),categories:{1:"ALG ALG.BINOM ALG.DET ALG.EQ.1ST ALG.EQ.2ND ALG.EQ.BIQUAD ALG.EQ.FRAC ALG.EQ.POLY ALG.EQ.SQRT ALG.EQ.SYS ALG.EQ.SYS.DISCUSS ALG.EQ.SYS.GAUSS ALG.EQ.SYS.NOLIN ALG.EQ.TRIG ALG.FRAC ALG.FRAC.OP ALG.FRAC.SIMP ALG.IDENT ALG.INEQ ALG.INEQ.1ST ALG.INEQ.2ND ALG.INEQ.SYS ALG.MATRIX ALG.MATRIX.OP ALG.MONOMIAL ALG.POLY ALG.POLY.BIQUAD ALG.POLY.DIV ALG.POLY.DIV.RUFINI ALG.POLY.FACTOR ALG.POLY.OP ALG.POLY.ROOTS ARI ARI.CONVERSIONS ARI.PERCENT ARI.PERCENT.CHAIN ARI.PERCENT.CHAIN.PB ARI.PERCENT.PB ARI.PROPORTIONS ARI.PROPORTIONS.COMPOUND ARI.PROPORTIONS.COMPOUND.PB ARI.PROPORTIONS.PB ARI.SUCCESSION EST EST.1D EST.1D.QUARTILS EST.2D EST.2D.REGRESSION FUN FUN.ASIMP FUN.COMPO FUN.CONT FUN.CURV FUN.DERIV FUN.DOM FUN.ELEMENTAL FUN.EXTREMA FUN.INFLEX FUN.INTG FUN.INTG.AREA FUN.INTG.VOLUM FUN.INVERSE FUN.LIM FUN.LIM.HOPITAL FUN.LIM.LATERAL FUN.MONOTONY FUN.PERIODIC FUN.REPR GEO GEO.ANA GEO.ANA.LINES GEO.ANA.MESURE GEO.ANA.PLANES GEO.ANA.POSITION GEO.AREA GEO.PERIMETER GEO.POLYHEDRA GEO.PYTHAGORAS GEO.THALES GEO.VEC GEO.VOLUM MISC NUM NUM.APROX NUM.CIENTIFIC NUM.COMPLEX NUM.COMPLEX.OP NUM.DEC NUM.DEC.OP NUM.DEC.PB NUM.DIV NUM.ERR NUM.FRAC NUM.FRAC.OP NUM.FRAC.PB NUM.FRAC.SIMP NUM.GCD NUM.INT NUM.INT.OP NUM.INT.PB NUM.INTERVAL NUM.LCM NUM.LOG NUM.LOG.OP NUM.LOG.PROP NUM.MULT NUM.POW NUM.POW.OP NUM.POW.PROP NUM.PRIME NUM.REAL NUM.REAL.OP NUM.REAL.PB NUM.SQRT NUM.SQRT.OP NUM.SQRT.PROP NUM.WHOLE NUM.WHOLE.OP NUM.WHOLE.PB NUN.SEG NUN.SEG.OP NUN.SEG.PB PROB PROB.BAYES PROB.BINOMIAL PROB.LAPLACE PROB.NORMAL PROB.TREE TRI TRI.COSTHEO TRI.FORMULA TRI.IDENTITIES TRI.RATIOS TRI.SINTHEO TRI.TRIANGLE".split(" "),
2:"MECANICA OPTICA ENERGIA CINEMATICA MAGNETISME ELECTRICITAT GRAVITACI\u00d3".split(" "),3:[]},activityTypes:["A","V","Q","U"],letters:" A B C D E F G H A/B B/C C/D".split(" "),langs:["ca","es","en"]}).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("uiDatetimePickerConfig",{dateFormat:"dd-MM-yyyy HH:mm",
defaultTime:"12:00:00",html5Types:{date:"dd-MM-yyyy","datetime-local":"dd-MM-yyyy HH:mm:ss",month:"MM-yyyy"},initialPicker:"date",reOpenDefault:!1,enableDate:!0,enableTime:!0,buttonBar:{show:!0,now:{show:!0,text:"Ara"},today:{show:!0,text:"Avui"},clear:{show:!0,text:"Esborra"},date:{show:!0,text:"Data"},time:{show:!0,text:"Temps"},close:{show:!0,text:"Tanca"}},closeOnDateSelection:!0,closeOnTimeNow:!0,appendToBody:!1,altInputFormats:[],ngModelOptions:{},saveAs:!1,readAs:!1});a.config(["$ocLazyLoadProvider",
"$qProvider","growlProvider","$stateProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$httpProvider",function(f,b,d,e,c,l,g,h,n){l.debugInfoEnabled(!1);l.commentDirectivesEnabled(!1);l.cssClassDirectivesEnabled(!1);b.errorOnUnhandledRejections(!1);h.decorator("$q",["$delegate",function(c){c.serial=function(b){var a,h=Error(),g=[];b=b.concat(function(){var b=c.defer();b.resolve(g);return b.promise});k.forEach(b,function(b,l){var d=b.success||b,n=b.fail,e=b.notify;if(a)e=
a.then(function(c){g.push(c);if(!d)return g;c=d(c);if(!c||!k.isFunction(c.then))throw h.message="Task "+l+" did not return a promise.",h;return c},function(b){if(!n)return c.reject(b);b=n(b);if(!b||!k.isFunction(b.then))throw h.message="Fail for task "+l+" did not return a promise.",h;return b},e);else if(e=d(),!e||!k.isFunction(e.then))throw h.message="Task "+l+" did not return a promise.",h;a=e});return a||c.when()};return c}]);f.config({jsLoader:requirejs,events:!0,debug:!1,modules:[{name:"ui.ace",
files:["uiace"]},{name:"ui.tree",files:["angular_tree"]},{name:"nzToggle",files:["nztoggle"]},{name:"ui.bootstrap.datetimepicker",files:["datetimepicker"]},{name:"multipleSelect",files:["multiple_select"]},{name:"fxpicklist",files:["fxpicklist"]},{name:"markdown",files:["showdown","markdown"]},{name:"jsxGraph",files:["jsxgraph"]},{name:"ngFileUpload",files:["fileupload"]},{name:"AngularPrint",files:["angular-print"]},{name:"ngJSPanel",files:["ngJSPanel"]},{name:"ui.tinymce",files:["ng_tinymce"]},
{name:"hljs",files:["ng_highlight"]},{name:"ngIdle",files:["ng_idle"]},{name:"angular-sortable-view",files:["angularSortable"]}]});a.register={controller:c.register,directive:l.directive,component:l.component,stateProvider:e,factory:h.factory,service:h.service,filter:g.register};d.globalTimeToLive(5E3);d.globalDisableCountDown(!0);d.onlyUniqueMessages(!1);h.decorator("$templateFactory",["$delegate",function(c){var b=k.bind(c,c.fromUrl);c.fromUrl=function(c,a){null!==c&&k.isDefined(c)&&k.isString(c)&&
(c+=-1===c.indexOf("?")?"?":"&",c+="bust="+m.pw.PW_VERSION);return b(c,a)};return c}]);n.interceptors.push(["$q","$state",function(c,b){return{responseError:function(a){401===a.status?(localStorage.removeItem("pwSession"),m.location.href="/"):403===a.status&&b.go("home.unauthorized");return c.reject(a)}}}])}]);a.run(["$rootScope","$location","$state","$transitions","Auth","$timeout","$anchorScroll","$http","$q","$translate","USER_ROLES",function(a,b,d,e,c,l,g,h,n,p,w){var k=jQuery("#viewloader");
a.scrollPos={};a.adjustPadding=function(c){var b=jQuery(c?"#navtop":".navbar-fixed-top");b&&b.ready(function(){var c=b.height()+1;jQuery("body").css("padding-top",c)})};h.postq=function(c,b){var a=n.defer();h.post(c,b).then(function(c){a.resolve(c.data)});return a.promise};a.tinymceOpts=function(c){return{inline:!1,valid_elements:"*[*]",cleanup:!1,verify_html:!1,language:c,plugins:"eqneditor autolink lists link image charmap print preview anchor code textcolor fullscreen",toolbar:"undo redo | eqneditor link image | styleselect forecolor backcolor | bold italic underline | bullist numlist outdent indent | charmap code | fullscreen",
skin:"lightgray",theme:"modern",extended_valid_elements:"script[charset|defer|language|src|type]"}};var q={ca:{1:"Comentaris",2:"Regularitat",3:"Millor de la setmana",4:"Millor del mes",5:"Repte de la setmana",50:"Guanyador d'un Kahoot",100:"Especial de Nadal",101:"Especial de Pasqua",200:"Deures fets",201:"Deures fets parcialment",202:"Treballa i participa a classe",203:"Participa a classe",300:"No ha fet els deures",301:"Xerra i/o molesta",302:"\u00das indegut d'aparells electr\u00f2nics",303:"No obeix al professor",
304:"No treballa a classe"},es:{1:"Comentarios",2:"Regularidad",3:"Mejor de la semana",4:"Mejor del mes",5:"Reto de la setmana",50:"Ganador de un Kahoot",100:"Especial de Navidad",101:"Especial de Pascua",200:"Deberes hechos",201:"Deberes parcialmente hechos",202:"Trabaja y participa en clase",203:"Participa en clase",300:"No ha hecho los deberes",301:"Habla y/o molesta",302:"Uso inadecuado de aparatos electr\u00f3nicos",303:"No obedece al profesor",304:"No trabaja en clase"},en:{1:"Comments",2:"Regularity",
3:"Best of the week",4:"Best of the month",5:"Week challenge",50:"Kahoot winner",100:"Xmas special badge",101:"Easter special badge",200:"Homework done",201:"Homework partially done",202:"Work and participate in class",203:"Participate in class",300:"Homework not done",301:"Speaks and / or annoys",302:"Improper use of electronic devices",303:"Does not obey the teacher",304:"Does not work in class"}};a.badgeDescription=function(c){var b=p.use();return(q[b]||{})[c]||"Badge"};g.yOffset=50;a.bypass=!1;
a.$on("$destroy",function(){h({url:"/rest/auth/logout",method:"POST",async:!1,data:{idLogin:c.Session.getUser().idLogin}})});jQuery(m).on("scroll",function(){a.okSaveScroll&&(a.scrollPos[b.path()]=jQuery(m).scrollTop())});e.onSuccess({},function(c){k.fadeOut(250);l(function(){a.okSaveScroll=!0;var h=a.scrollPos[b.path()];jQuery(m).scrollTop(h?h:0);"home"===c.$to().name?jQuery("#homeDashboard").fadeIn(100):jQuery("#homeDashboard").fadeOut(250)})});e.onError({},function(c){k.fadeOut(250)});e.onBefore({to:"home.**"},
function(b){var a=!0,h=b.to();"login"===b.from().name&&"home.activity"===h.name&&localStorage.setItem("cachedRouteTo",JSON.stringify({name:h.name,params:b.params()}));h&&h.data&&h.data.authorizeRoles&&!c.isAuthorized(h.data.authorizeRoles)&&(console.log("Upps! Not authorized?",h.name),a=!1);if(h&&h.data&&h.data.authStateParams){var g=n.defer(),a=g.promise;c.authStateParams(h.name,b.params()).then(function(c){c?g.resolve(!0):(console.log("Not authorized"),g.resolve(!1))})}return a});e.onStart({to:"login"},
function(b){b=c.isAuthenticated();var a=n.defer();b.then(function(b){b&&(c.Session.getUser().idRole===w.parents?d.go("home.parents"):d.go("home"));a.resolve()});return a.promise})}]);m.pw.app=a;m.app=a;m.pw.app.init=function(){m.pw.errors?(console.log("Piworld bootstrap cancelled due to errors"),console.error("Piworld bootstrap cancelled due to errors")):k.element(function(){k.bootstrap(document,["piWorld"]);jQuery("#loader").remove();m.clearTimeout(m.pw.hangTimeout);m.onerror=null;console.error=
m.pw.olderr})}})(angular,window);(function(k,m){k.directive("whenScrollEnds",function(){return{restrict:"A",link:function(b,a,e){var c=a.height();a.scroll(function(){100>=a.prop("scrollHeight")-c-a.scrollTop()&&b.$apply(e.whenScrollEnds)})}}});k.directive("errSrc",function(){return{restrict:"A",link:function(b,a,e){var c=b.$watch(function(){return e.ngSrc},function(c){c||a.attr("src",e.errSrc)});a.bind("error",function(){a.attr("src",e.errSrc)});b.$on("$destroy",function(){c()})}}});k.directive("lazyStyle",["Session",function(b){return{restrict:"E",
link:function(a,e,c){c.$observe("href",function(c){b.addCss(c)})}}}]);k.directive("loadingContainer",function(){return{restrict:"A",scope:!1,link:function(a,d,e){var c=m.element('<div class="loading"></div>');d.append(c);d.addClass("loading-container");var l=a.$watch(e.loadingContainer,function(a){c.toggleClass("ng-hide",!a)});a.$on("$destroy",function(){c.toggleClass("ng-hide",!0);l()})}}});k.directive("scrollBottom",["$timeout",function(a){return{scope:{scrollBottom:"="},link:function(d,e){var c=
d.$watchCollection("scrollBottom",function(c){c&&a(function(){$(e).scrollTop($(e)[0].scrollHeight+10)},600)});d.$on("$destroy",c)}}}]);var a=function(a,d,e){return{scope:{katexServer:"<",kts:"<"},restrict:"A",link:function(c,l,g){var h;a.addCss(pw.KATEXCSS);var n=function(a){a=a.replace(/katex-server=""/g,"").replace(/ng-cloak/g,"");d.post("/rest/misc/latex2",{html:a,alone:g.alone,dollar2:g.doubleDollar}).then(function(a){l.empty().append(a.data);g.noCompile||e(l.contents())(c)})},p=function(a){return c.$watch(a,
function(c,a){n(c||"")})};g.katexServer?g.compileOnce?(n(c.katexServer),l.removeAttr("katexServer")):h=p("katexServer"):g.kts?g.compileOnce?(n(c.kts),l.removeAttr("kts")):h=p("kts"):(n(l.html()),l.removeAttr("kts"),l.removeAttr("katexServer"));c.$on("$destroy",function(){h&&h()})}}};k.directive("katexServer",["Session","$http","$compile",a]);k.directive("kts",["Session","$http","$compile",a]);var f={"\\Re":"\\mathbb{R}","\\alf":"\\alpha","\\tg":"\\mathrm{tg}\\,","\\arctg":"\\mathrm{arctg}\\,","\\cotg":"\\mathrm{cotg}\\,",
"\\cosec":"\\mathrm{cosec}\\,"},a=function(a){function d(c,a,b){b.empty().append(c);b.css({color:"red","font-style":"italic"});pw.DEBUG&&console.log(a)}function e(c,a){var b=!1;"div"===a[0].tagName.toLowerCase()&&(c="\\displaystyle {"+c+"}",a.addClass("katex-outer"),b=!0);if(window.katex)try{window.katex.render(c,a[0],{displayMode:b,macros:f})}catch(h){d(c,h,a)}else require(["katex"],function(h){try{window.katex=h,h.render(c,a[0],{displayMode:b,macros:f})}catch(n){d(c,n,a)}})}return{scope:{expr:"<",
katex:"<",kt:"<"},restrict:"AE",link:function(c,l,g){a.addCss(pw.KATEXCSS);var h,d=function(a){return c.$watch(a,function(c,a){p=c||"";0<=p.indexOf("Error")&&(p="?");e(p,l)})},p="";g.katex?g.compileOnce?e(c.katex,l):h=d("katex"):g.kt?g.compileOnce?e(c.kts,l):h=d("kt"):g.expr?g.compileOnce?e(c.expr,l):h=d("expr"):(p=l.html(),e(p,l));c.$on("$destroy",function(){h&&h()})}}};k.directive("katex",["Session",a]);k.directive("kt",["Session",a]);k.directive("geogebra",["$translate",function(a){return{restrict:"A",
replace:!1,scope:{model:"=ngModel",geogebra:"@geogebra"},link:function(d,e,c){e.html("<h2>Geogebra loading ...</h2>");require(["geogebra"],function(){var l=e.text().trim();e.text("");var g=c.perspective||2,h=c.app&&"true"===c.app,n=a.proposedLanguage()||a.use(),p="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";
h&&(p=null);d.model&&d.model.base64&&(p=d.model.base64);var f=Math.floor(1E6*Math.random()),k="ggbApplet"+f,q=0,m=0;c.width&&(q=c.width);c.height&&(m=c.height);var t=e.attr("id");t||(t="ggbContainer"+f);var z="ggbSpinner"+f;e.html("<div id='"+z+"'><center><h2>GeoGebra <img src='assets/img/ajax-loader0.gif'/></h2></center></div><div id='"+t+"'></div>");var u={id:k,showToolBar:h,showMenuBar:h,showAlgebraInput:h,showResetIcon:!1,enableLabelDrags:!0,enableShiftDragZoom:!0,enableRightClick:h,showToolBarHelp:!1,
errorDialogsActive:!0,useBrowserForJS:!1,language:n,isPreloader:!1,screenshotGenerator:!1,preventFocus:!1,fixApplet:!1,prerelease:!1,lf:"modern",app:!0,perspective:g};q&&(u.width=q);m&&(u.height=m);p&&(u.ggbBase64=p);if(c.parameters)try{var C=JSON.parse(c.parameters),v;for(v in C)u[v]=C[v]}catch(A){window.pw.app.DEBUG&&console.log("Geogebra directive parse error: "+A)}if(d.model&&d.model.parameters)for(var y in d.model.parameters)u[y]=d.model.parameters[y];u.appletOnLoad=function(){jQuery("#"+z).hide();
var c=document[k];2===u.perspective&&(c.evalCommand("ZoomIn[-10,-10,10,10]"),c.setGridVisible(!0),c.setAxesVisible(!0,!0),c.refreshViews());if(l&&!l.trim().endsWith("==")){var a=l.split(";");jQuery.each(a,function(a,b){b=b.trim();var h=b.indexOf("(");if(b&&0<=h){var g=b.slice(0,h);g||(g="evalCommand");var l=c[g];if(l){h="["+b.slice(h+1,-1)+"]";g=[];try{g=JSON.parse(h)}catch(d){window.pw.app.DEBUG&&console.log(d)}l.apply(c,g)}else window.pw.app.DEBUG&&console.log("geogebra: unknown cmd "+g)}})}if(d.model&&
d.model.onLoad)d.model.onLoad(c);"function"===typeof $&&void 0!==window.GGBT_wsf_view&&(a=$("#ggbContainer"+f),window.GGBT_wsf_view.postProcessApplet(a))};g={is3D:!1,AV:!1,SV:!1,CV:!1,EV2:!1,CP:!0,PC:!1,DA:!1,FI:!1,PV:!1,macro:!1};if(c.views)try{var D=JSON.parse(c.views);for(v in D)g[v]=D[v]}catch(A){window.pw.app.DEBUG&&console.log("Geogebra directive parse error: "+A)}if(d.model&&d.model.views)for(y in d.model.views)g[y]=d.model.views[y];var r;d.geogebra?(r=new GGBApplet({material_id:d.geogebra,
appletOnLoad:function(){jQuery("#"+z).hide()}},!0),r.setPreviewImage("https://tube.geogebra.org/images/GeoGebra_loading.png?v="+d.geogebra)):(r=new GGBApplet("5.0",u,g),r.setHTML5Codebase("https://www.geogebra.org/web/5.0/web/",!0),r.setJNLPBaseDir("https://tube.geogebra.org/webstart/"),r.setGiacJSURL("https://tube.geogebra.org/webstart/4.4/giac.js"));e.ready(function(){r.inject(t,"auto");console.log(r);console.log(r.getAppletObject())});e.on("$destroy",function(){r.removeExistingApplet(t,!1);r=null})})}}}]);
k.directive("activityEmbed",function(){return{restrict:"E",scope:{activity:"<"},link:function(a,d,e){console.log(a);var c="?idAssignment="+(a.activity.idAssignment||0);if(a.autoplay||e.autoplay)c+="&auto=1";if(a.debug||e.debug)c+="&debug=1";if(a.guest||e.guest)c+="&guest=1";if(a.test||e.test)c+="&test=1";d.addClass("activity-embed embed-responsive embed-responsive-16by9");var c="/activities/"+a.activity.id+"/index.html"+c,l=$('<iframe class="embed-responsive-item" src="'+c+'"></iframe>');d.append(l);
var g=jQuery('<div class="btn-fullscreen"><button class="btn btn-default glyphicon glyphicon-glyphicon glyphicon-resize-full"></button></div>');d.append(g);jQuery('<div class="pull-right" style="font-size:12px; font-family: sans-serif"><a href="'+c+'" target="_blank"><span class="glyphicon glyphicon-link"></span>Obrir en una finestra nova.</a></div>').insertAfter(d);var h=g.find("button");h.on("click",function(c){window.pw.FScreen.toggleFullscreen(d,h)});window.pw.FScreen.setOnfullscreenchange(function(c){window.pw.FScreen.fullscreenElement()||
window.pw.FScreen.exitFullscreen()});pw.iframeAPI.attachListener(function(c,g){if("fullscreen"===e.onplay||"fullscreen"===a.activity.onplay)"onPlay"===c&&window.pw.FScreen.requestFullscreen(d,h),"onEnd"===c&&window.pw.FScreen.exitFullscreen(d,h)});a.$on("$destroy",function(){h.off();pw.iframeAPI.destroy();l.attr("src","about:blank");window.pw.FScreen.setOnfullscreenchange(null)})}}});k.directive("compile",["$compile",function(a){return{restrict:"A",scope:{compile:"<"},link:function(d,e,c){var l,g=
function(c){e.html(c);a(e.contents())(d)};c.compileOnce?g(d.compile):l=d.$watch("compile",g);d.$on("$destroy",function(){l&&l()})}}}]);k.directive("beanEditor",["$compile",function(a){return{restrict:"E",scope:{ngModel:"=ngModel",ngDisabled:"=ngDisabled",beanOpts:"=beanOpts"},link:function(d,e,c){d.tgs={};d.beanOpts=d.beanOpts||{canAdd:!1,canDel:!1,readonly:{},hide:{}};d.delProp=function(c,a,b){var l=d.ngModel,e=l;c.substring(1).split(".").forEach(function(a){e=l;l=l[a];c=a});delete e[c];if(a=m.element(jQuery("#"+
a)))a.html(""),a.remove();b&&(a=m.element(jQuery("#"+b)))&&(a.html(""),a.remove())};d.addProp=function(c,a){c.substring(1).split(".").forEach(function(c){})};var l=function(c,a){var b="";a=a||".";Object.keys(c).forEach(function(d){var e=Math.random().toString(36).slice(2);b+="<tr id='"+e+"' ng-if='!beanOpts.hide"+a+d+"'>";var f=c[d],k=typeof f,m="<button class='btn btn-xs btn-danger' title='Delete property' ng-if='beanOpts.canDel' ng-click='delProp(\""+a+d+'", "'+e+"\")'>x</button> ",t="<button class='btn btn-xs btn-success' title='Add property' ng-if='beanOpts.canAdd' ng-click='addProp(\""+
a+d+'", "'+e+"\")'>+</button> ";"string"===k?b+="<td> "+m+d+"</td><td> <input type='text' ng-disabled='ngDisabled || beanOpts.readonly"+a+d+" ' ng-model='ngModel"+a+d+"'/></td>":"number"===k?b+="<td>"+m+d+"</td><td> <input type='number' ng-disabled='ngDisabled || beanOpts.readonly"+a+d+" ' ng-model='ngModel"+a+d+"'/></td>":"boolean"===k?b+="<td>"+m+d+"</td><td> <input type='checkbox' ng-disabled='ngDisabled || beanOpts.readonly"+a+d+" ' ng-model='ngModel"+a+d+"'/></td>":"object"===k?(k=(a+d).replace(/\./g,
"_"),m=Math.random().toString(36).slice(2),b+="<td colspan='2'><button class='btn btn-xs btn-default' ng-click='tgs."+k+"=!tgs."+k+"'><span ng-if='!tgs."+k+"'>-</span><span ng-if='tgs."+k+"'>+</span></button>  <b>"+("<button class='btn btn-xs btn-danger' title='Delete' ng-if='beanOpts.canDel' ng-click='delProp(\""+a+d+'", "'+e+'", "'+m+"\")'>x</button> ")+d+"</b>  "+t+"</td>",b+="<tr id='"+m+"'><td></td><td><table ng-if='!tgs."+k+"'>",b+=l(f,a+d+"."),b+="</td></table></tr>"):b+="<td>"+d+"</td><td> <span ng-bind='ngModel"+
a+d+"'></span></td>";b+="</tr>"});return b};c="<table>";d.ngModel&&(c+=l(d.ngModel));e.html(c+"</table>");a(e.contents())(d)}}}])})(window.pw.app,angular);(function(k,m){k.factory("PwTable",["$q","$filter",function(a,f){return function(b,d){var e=this;b.filter=b.filter||{};b.sorting=b.sorting||[];b.classes=b.classes||{};b.maxSize=b.maxSize||5;b.total=0;b.page=b.page||1;b.count=b.count||10;b.counts=b.counts||[10,20,30];this.params=b;this.$loading=!1;this.sortBy=function(a){var c=e.params.sorting.map(function(a){return a.replace("+","").replace("-","")}).indexOf(a);if(0>c)e.params.sorting.unshift("+"+a);else{var b=e.params.sorting[c].substring(0,1);"+"===
b||"+"!==b&&"-"!==b?e.params.sorting[c]="-"+a:(e.params.sorting.splice(c,1),e.params.classes[a]="")}e.paginate()};var c=function(){var a;e.params.sorting.length&&(a=e.params.sorting,e.params.classes={},jQuery.each(e.params.sorting,function(a,c){var b="+";"-"===c.substring(0,1)&&(b="-");var d=c.replace("+","").replace("-","");e.params.classes[d]="-"===b?"glyphicon glyphicon-chevron-down":"glyphicon glyphicon-chevron-up"}));return a};this.setCount=function(a){e.params.count=a||1;e.paginate()};this.reload=
function(){var c=a.defer();this.$loading=!0;d(c,b);c.promise.then(function(a){e.allData=a;e.params.page=1;e.paginate();e.$loading=!1})};this.paginate=function(){var a=m.copy(this.allData),b=!1,d;for(d in e.params.filter)e.params.filter[d]&&e.params.filter[d].trim()&&(b=!0);a=b?f("filter")(a,this.params.filter):a;this.params.total=a.length;this.pages=Math.ceil(this.params.total/this.params.count);a=(b=c())?f("orderBy")(a,b):a;this.$data=a=a.slice((this.params.page-1)*this.params.count,this.params.page*
this.params.count)};this.reload()}}]);k.factory("MyCacheService",["$q","$http","$interval",function(a,f,b){function d(c,d){this.key=c;this.expirable=d;this.cacheData={};this.timer=null;if(d){var h=this;"number"!==typeof this.expirable&&(this.expirable=3E5);0<this.expirable&&(this.timer=b(function(){for(var a in h.cacheData)h.cacheData[a].valid=!1},this.expirable))}this.httpCache=function(c,b,d,h){var g=a.defer(),l=this;h&&delete this.cacheData[c];this.cacheData[c]&&this.cacheData[c].valid?g.resolve(this.cacheData[c].data):
f.post("/rest/"+b,d).then(function(a){l.cacheData[c]={valid:!0,data:a.data};g.resolve(a.data)});return g.promise};this.put=function(a,c){this.cacheData[a]=c};this.get=function(a,c){var b=this.cacheData[a];!b&&c&&(this.cacheData[a]=c,b=this.cacheData[a]);return b};this.destroy=function(){this.cacheData={};this.timer&&b.cancel(this.timer)}}var e={},c={};e.getCache=function(a,b){if(c[a])return c[a];var h=new d(a,b);return c[a]=h};e.destroy=function(a){if(a){var b=c[a];b&&(b.destroy(),delete c[a])}else for(b in c)e.destroy(b)};
return e}]);k.service("Session",["USER_ROLES","CONFIG","MyCacheService","$http","$rootScope","$state","$location","AUTH_EVENTS","$timeout","$q",function(a,f,b,d,e,c,l,g,h){var n=function(){var a=null,c=function(){this.on=function(a,c,b){console.log("Socket.on "+a+" is disabled.")};this.emit=function(a,c,b){console.log("Socket.emit "+a+" is disabled.")}};this.connect=function(){if(window.io)try{pw.DEBUG&&console.log("socket:: creating new socket with ",f.SERVERIP),a=window.io.connect(f.SERVERIP,{forceNew:!0,
"force new connection":!0})}catch(b){console.log("socket:: Unable to connect to socket: "+a),c()}else console.log("Can't find window.io library... creating a fake socket object"),c()};this.on=function(c,b,d){pw.DEBUG&&console.log("socket on:: ",c);a||this.connect();a.on(c,function(a,c){b&&h(b(a))})};this.emit=function(c,b,d){a||this.connect();pw.DEBUG&&console.log("socket emit:: ",c,b);a.emit(c,b,function(a){d&&h(d(a))})};this.disconnect=function(){if(a&&a.disconnect)try{a.disconnect(),a=null}catch(c){console.log("Unable to disconnect socket: ",
c)}};return this},p;this.roles=a;this.assignmentsCache={};var k=localStorage,m=this,q=function(a){"pwSession"===a.key&&(null!==a.oldValue&&null===a.newValue?(console.log("Session closed in one tab; propagate to all tabs..."),m.logout()):null===a.oldValue&&null!==a.newValue&&(console.log("Session started in one tab; propagate to all tabs..."),c.go("home")))};window.addEventListener?addEventListener("storage",q):window.attachEvent&&attachEvent("onstorage",q);this.create=function(c){c.config=c.config||
{};this.user=c;this.css=[];c.idRole===a.parents&&this.updateStore();this.initialize();return c};var x=function(a){if(document.createStyleSheet)document.createStyleSheet(a);else{var c=document.createElement("link");c.type="text/css";c.rel="stylesheet";c.href=a;document.getElementsByTagName("head")[0].appendChild(c)}};this.recoverStore=function(){var a=k.getItem("pwSession"),c={};if(a)try{var b=pw.decrypt(a),c=JSON.parse(b);this.user=c.user||{};this.user.isStore=!0;this.css=c.css||[];$.each(this.css,
function(a,c){x(c)});this.selectedGroup=c.selectedGroup||{};this.grp=c.grp||{};this.student=c.student||{};this.related=c.related||[]}catch(d){}return c};this.updateStore=function(){var a={user:this.user,css:this.css,selectedGroup:this.selectedgroup,grp:this.grp,student:this.student,related:this.related};try{var c=pw.encrypt(JSON.stringify(a));k.setItem("pwSession",c)}catch(b){console.log(b)}};this.destroy=function(){k.removeItem("pwSession");localStorage.removeItem("pwSession");this.student=this.related=
this.selectedgroup=this.grp=this.css=this.user=null;p&&p.disconnect();p=null;b.destroy();localStorage.removeItem("ngIdle.expiry");this.assignmentsCache={};this.destroyed=!0};this.updateUopts=function(){d.post("/rest/students/updateuopts",this.user.uopts);this.updateCookies()};this.getUser=function(){return this.user||{}};this.setGroup=function(a){this.grp=a;this.destroyed=!1;this.updateStore()};this.getGroup=function(){return this.grp||{}};this.setRelatedActivity=function(a){this.related=a;this.updateStore()};
this.getRelatedActivity=function(){return this.related||[]};this.setCurrentGroup=function(a){this.selectedgroup=a;this.updateStore()};this.getCurrentGroup=function(){return this.selectedgroup||{}};this.setStudent=function(a){this.student=a;this.updateStore()};this.getStudent=function(){return this.student||{}};this.getCss=function(){return this.css||[]};this.addCss=function(a){if(a&&0!==a.trim().length&&a.trim().toLowerCase().endsWith(".css")){var c=this.getCss();c&&0>$.inArray(a,c)&&(this.updateStore(),
c.push(a),x(a))}else console.log("Session.addCss: Invalid path "+a)};this.removeCss=function(a){var c=this.getCss();c&&(c=$.inArray(a,c),0<=c&&(this.getCss().splice(c,1),$('link[href="'+a+'"]').prop("disabled",!0).remove(),this.updateStore()))};this.logout=function(){var c=this.getUser();if(c)if(c.idRole===a.guest)m.destroy(),e.$broadcast(g.logoutSuccess),l.path("/login");else{var b=function(a){m.destroy();e.$broadcast(g.logoutSuccess);l.path("/login")};d.post("/rest/users/logout",{idLogin:c.idLogin,
idUser:c.id}).then(b,b)}else l.path("/login")};this.soundSupported=!0;this.getSocket=function(){p||(p=new n,p.connect());return p};pw.Sound.register({newchat:"/assets/sounds/chat.ogg"});this.initialize=function(){pw.DEBUG&&console.log("Session service initialization...")};this.recoverStore();return this}]);k.service("Modals",["$uibModal","$timeout",function(a,f){var b=(new Date).getTime();this.resetLatency=function(){b=(new Date).getTime()};this.sudlg=function(d,e){var c=(new Date).getTime();if(12E4<
c-b){var l=a.open({templateUrl:"app/shared/su-dlg.html",controller:["$scope","Auth",function(a,d){a.cpwd={text:""};a.invalidpwd="";var e=0;f(function(){jQuery("#su-dlg").focus()});a.ok=function(){d.checkPassword(a.cpwd.text).then(function(d){d.ok?(b=c,l.close()):(a.invalidpwd="Invalid password",e+=1,3<e&&l.dismiss())})};a.cancel=function(){l.dismiss()}}],size:"md"});l.result.then(function(){d&&d()},function(){e&&e()})}else b=c,d&&d()};this.notificationdlg=function(b,e,c,l){var g=a.open({templateUrl:"app/shared/notification-dlg.html",
controller:["$scope",function(a){a.ok=function(){g.close()};a.title=b;a.msg=e}],size:l?l.size||"md":"md"});g.result.then(function(){c&&c()},function(){c&&c()});return g};this.inputdlg=function(b,e,c,l,g,h){var n=a.open({templateUrl:"app/shared/input-dlg.html",controller:["$scope",function(a){f(function(){jQuery("#input-dlg").focus()});a.ok=function(){n.close(a.model.text)};a.cancel=function(){n.dismiss()};a.title=b;a.msg=e;a.model={text:c};a.typetextarea=h?"textarea"===h.type:!1}],size:h?h.size||
"md":"md"});n.result.then(function(a){l&&l(a)},function(){g&&g()});return n};this.confirmdlg=function(b,e,c,l,g,h){var f=a.open({templateUrl:"app/shared/confirm-dlg.html",controller:["$scope",function(a){a.ok=function(){f.close()};a.cancel=function(){f.dismiss()};a.reject=function(){f.dismiss(-1)};a.title=b;a.msg=e;a.rejection="N";h&&"function"===typeof h&&(a.rejection="Y")}],size:g?g.size||"md":"md"});f.result.then(function(){c&&c()},function(a){-1===a?h&&h():l&&l()});return f};this.confirmdlgpwd=
function(d,e,c,l,g){var h=(new Date).getTime(),n=12E4<h-b;n||(b=h);var k=a.open({templateUrl:"app/shared/confirm-dlg-pwd.html",controller:["$scope","Auth",function(a,c){f(function(){jQuery("#confirm-input-pwd").focus()});a.cpwd={text:""};a.invalidpwd="";a.title=d;a.msg=e;a.requirePwd=n;var g=0;a.ok=function(){n?c.checkPassword(a.cpwd.text).then(function(c){c.ok?(b=h,k.close()):(a.invalidpwd="Invalid password",g+=1,3<g&&k.dismiss())}):k.close(!0)};a.cancel=function(){k.dismiss()}}],size:g?g.size||
"md":"md"});k.result.then(function(){c&&c()},function(){l&&l()});return k};return this}]);k.factory("Auth",["$http","$rootScope","$q","Session","AUTH_EVENTS","$translate","USER_ROLES",function(a,f,b,d,e,c,l){var g={};g.Session=d;g.guest=function(){var c=b.defer(),g={id:-1,idRole:l.guest,fullname:"Guest user",groups:[],uopts:{postcomments:!1}};a.post("/rest/subjects/list").then(function(a){jQuery.each(a.data,function(a,c){g.groups.push({id:0,groupName:c.name,idSubject:c.id,gopts:{postcomments:!0,allowenroll:!1}})});
d.create(g);c.resolve(g)});return c.promise};g.login=function(b,g,k){return a({method:"POST",url:"/rest/users/login",data:pw.encrypt(JSON.stringify(b)),headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then(function(a){a=a.data;a.ok?(a=JSON.parse(pw.decrypt(a.user_info)),b.parents&&(a.idRole=l.parents),d.create(a),a.uopts&&a.uopts.lang&&c.use(a.upots.lang),f.$broadcast(e.loginSuccess),g&&g(a)):(f.$broadcast(e.loginFailed),k&&k(a.msg))})};g.isAuthenticated=function(){var c=b.defer(),g=d.getUser();
if(null==g||null==g.cfp||g.mustChgPwd&&500!==g.idRole)c.resolve(!1);else if(g.isStore){var e=pw.encrypt(JSON.stringify({idUser:g.id,cfp:g.cfp,idLogin:g.idLogin}));a({method:"POST",url:"/rest/users/auth",data:e,headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then(function(a){a.data.ok?g.isStore=!1:(console.log("The current session is not valid ... loging out!",a.data),localStorage.removeItem("pwSession"),sessionStorage.removeItem("pwSession"));c.resolve(a.data.ok)})}else c.resolve(!0);return c.promise};
g.isAuthorized=function(a){m.isArray(a)||(a=[a]);var c=d.getUser();c||(c={idRole:l.guest});pw.DEBUG&&console.log("isAutorized",c,a);return-1!==a.indexOf(c.idRole)};g.authStateParams=function(c,g){var e=d.getUser(),f=b.defer();e&&e.idRole===l.admin?f.resolve(!0):e?a.post("/rest/auth/authstateparams",{route:c,params:g,username:e.username,idRole:e.idRole,schoolId:e.schoolId}).then(function(a){f.resolve(a.data)}):f.resolve(!1);return f.promise};g.checkPassword=function(c){var g=d.getUser(),e=b.defer();
g||e.resolve({ok:!1});var f={idUser:g.id};g.idRole===l.parents?f.passwordParents=c:f.password=c;c=pw.encrypt(JSON.stringify(f));a({method:"POST",url:"/rest/users/auth",data:c,headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then(function(a){e.resolve(a.data)});return e.promise};g.logout=d.logout;return g}])})(window.pw.app,angular);(function(k,m){k.filter("nameShortener",function(){return function(a){var f=a.split(",");if(1<f.length){a=f[0].replace(/  /gi," ").split(" ");var b=a[0];1<a.length&&(b+=" "+a[1].substring(0,1)+".");return b+=", "+f[1]}return a}});k.filter("timeHMS",["$translate",function(a){return function(f){if(null==f)return a.instant("NEVER");var b=Math.floor(f/3600),d=Math.floor((f-3600*b)/60);f=Math.round(f-3600*b-60*d);0===b&&0===d&&0===f?b=a.instant("NOW"):(b=(10>b?"0"+b:b)+":"+((10>d?"0"+d:d)+":"),b+=10>f?
"0"+f:f);return b}}]);k.filter("timeDHM",["$translate",function(a){return function(f){if(null==f)return a.instant("NEVER");f=.001*(new Date).getTime()-f;var b=Math.floor(f/86400),d=Math.floor((f-86400*b)/3600);f=Math.floor((f-86400*b-3600*d)/60);return b+" "+a.instant("DAYS")+" "+d+" "+a.instant("HOURS")+" "+f+" "+a.instant("MINUTES")+" "}}]);k.filter("correct",function(){return function(a){a=a||"";var f=a.toLowerCase().trim();"s"===f?a="<span style='color:green'>SI</span>":"n"===f&&(a="<span style='color:red'>NO</span>");
return a}});k.filter("rolename",["USER_ROLES",function(a){return function(f){var b=f||"";return b=f===a.admin?"ADMINISTRATOR":f===a.teacher?"TEACHER":f===a.teacherNonEditing?"TEACHER-nonEditing":f===a.teacheradmin?"TEACHER ADMIN":f===a.student?"STUDENT":f===a.guest?"GUEST":f===a.parents?"FAMILY":f+"-UNKNOWN"}}])})(window.pw.app,angular);(function(k,m){k.config(["$stateProvider","$urlRouterProvider","USER_ROLES",function(a,f,b){f.otherwise("/login");var d=window.pw.DEBUG?".js":".min.js",e=function(a,b,d,h){pw.DEBUG&&console.log("lazyLoader:: files="+b,"; deps=",d);"string"===typeof b&&(b=[b]);d&&"string"===typeof d&&(d=[d]);if(h)for(var f=b.length,k=0;k<f;k++)require.undef(b[k]);var m=a.defer();d?e(a,d,h).then(function(){e(a,b,h).then(function(){m.resolve()})}):require(b,function(){window.pw.DEBUG&&console.log("lazyLoader:: RESOLVED files="+
b);m.resolve()},function(a){console.log("lazyLoader:: ERROR! files ",b," cannot be resolved; ",a);m.resolve()});return m.promise};f=function(a,b,d){return["$q",function(h){return e(h,a,b,d)}]};a.state("login",{url:"/login",templateUrl:"app/components/login/login.html",controller:"LoginController",data:{authorizeRoles:[b.admin,b.teacher,b.teacherNonEditing,b.teacheradmin,b.student,b.guest,b.undefined]}}).state("pw",{url:"/pw",template:'<div id="pwroot" ui-view></div>',"abstract":!0,resolve:{isAuth:["Auth",
"$state",function(a,b){var d=a.isAuthenticated();d.then(function(a){a||(console.log("Not authenticated. Going to login ..."),b.go("login"))});return d}]}}).state("home",{parent:"pw",url:"^/home",templateProvider:["$http","$q","Session",function(a,d,g){var e=g.getUser(),e=e?e.idRole:b.student;(g=g.getCurrentGroup())&&(e=g.idRole||e);var f=d.defer();d=e===b.admin?"/app/components/home/home_admin":e<b.student?"/app/components/home/home_teacher":e===b.guest?"/app/components/home/home_guest":"/app/components/home/home";
pw.bowser.mobile&&(d+="_mobile");a.get(d+".html").then(function(a){f.resolve(a.data)});return f.promise}],controller:"HomeController",resolve:{loadCtrl:["$q","Session",function(a,f){var g=f.getUser(),g=g?g.idRole:b.guest,h=f.getCurrentGroup();h&&(g=h.idRole||g);return e(a,g===b.admin?"/app/components/home/home_admin"+d:g<b.student?"/app/components/home/home_teacher"+d:g===b.guest?"/app/components/home/home_guest"+d:"/app/components/home/home"+d,["app/app.components.min.js"])}],lazyModules_tinymce:["$ocLazyLoad",
"Session",function(a,d){return d.getUser().idRole<b.student?a.load("ui.tinymce"):!0}],lazyModules_sortableview:["$ocLazyLoad","Session",function(a,d){return d.getUser().idRole<b.student?a.load("angular-sortable-view"):!0}],lazyModules_ngFileUpload:["$ocLazyLoad",function(a){return a.load("ngFileUpload")}],ngVideoEmbed:f("video_embed"),translate_resolve:["Session","$translate",function(a,b){var d=a.getUser(),e=navigatorLang();d&&d.language&&(e=d.language);d&&d.groups&&d.groups.length&&(d=d.groups[0],
d.gopts.lang&&(e=d.gopts.lang));return b.use(e)}],lazyModules_datetime:["$ocLazyLoad",function(a){return a.load("ui.bootstrap.datetimepicker")}]}}).state("home.parents",{url:"/parents",templateProvider:["$http","$q",function(a,b){var d="/app/components/parents/progress_parents",e=b.defer();pw.bowser.mobile&&(d+="_mobile");a.get(d+".html").then(function(a){e.resolve(a.data)});return e.promise}],controller:"ParentsProgressController",resolve:{loadCtrl:f("app/components/parents/progress_parents.min.js")},
data:{authorizeRoles:[b.parents]}}).state("home.grades",{url:"/grades",templateUrl:"/app/components/parents/progress_students.html",controller:"StudentsProgressController",resolve:{loadCtrl:f("app/components/parents/progress_students.min.js")},data:{authorizeRoles:[b.student]}}).state("home.pwprogress",{url:"/pwprogress",templateProvider:["$http","$q",function(a,b){var d="/app/components/parents/pwprogress",e=b.defer();pw.bowser.mobile&&(d+="_mobile");a.get(d+".html").then(function(a){e.resolve(a.data)});
return e.promise}],controller:"PwProgressController",resolve:{loadCtrl:f("app/components/parents/pwprogress.min.js")},data:{authorizeRoles:[b.parents]}}).state("home.groups",{url:"/groups",templateUrl:"app/components/groups/groups.html",controller:"GroupsController",resolve:{loadCtrl:f("groupsCtrl")},lazyModules_sortableview:["$ocLazyLoad",function(a){return a.load("angular-sortable-view")}],data:{authorizeRoles:[b.admin,b.teacher,b.teacherNonEditing,b.teacheradmin]}}).state("home.files",{url:"/files",
templateUrl:"app/components/groups/files.html",controller:"FilesCtrl",resolve:{loadCtrl:f("app/components/groups/filesCtrl.js"),lazyModules_tree:["$ocLazyLoad",function(a){return a.load("ui.tree")}],lazyModules_ngFileUpload:["$ocLazyLoad",function(a){return a.load("ngFileUpload")}],lazyModules_ace:["$ocLazyLoad",function(a){return a.load("ui.ace")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacherNonEditing,b.teacheradmin]}}).state("home.students",{url:"^/home/students/:id",params:{id:""},templateUrl:"app/components/students/students.html",
controller:"StudentsController",resolve:{loadCtrl:f("studentsCtrl"),lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("fxpicklist")}],lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacherNonEditing,b.teacheradmin],authStateParams:!0}}).state("home.progress",{url:"^/home/progress/:id/:idUser",params:{id:"",idUser:""},templateUrl:"app/components/students/progress.html",controller:"ProgressController",resolve:{loadCtrl:f("progressController",
"jsxgraphcore")},data:{authorizeRoles:[b.admin,b.teacher,b.teacherNonEditing,b.teacheradmin],authStateParams:!0}}).state("home.editactivityA",{url:"^/home/editactivity/a/{idActivity:int}",templateUrl:"app/components/ide/newActivityA.html",controller:"newActivityACtrl",resolve:{loadCtrl:f("app/components/ide/newActivityA.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}],lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("multipleSelect")}]},data:{authorizeRoles:[b.admin,
b.teacher,b.teacheradmin]}}).state("home.editactivityQ",{url:"^/home/editactivity/q/{idActivity:int}",templateUrl:"app/components/ide/newActivityQ.html",controller:"newActivityQCtrl",resolve:{loadCtrl:f("app/components/ide/newActivityQ.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}],lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("multipleSelect")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin]}}).state("home.editactivityV",{url:"^/home/editactivity/v/{idActivity:int}",
templateUrl:"app/components/ide/newActivityV.html",controller:"newActivityVCtrl",resolve:{loadCtrl:f("app/components/ide/newActivityV.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}],lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("multipleSelect")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin]}}).state("home.editactivityU",{url:"^/home/editactivity/u/{idActivity:int}",templateUrl:"app/components/ide/newActivityU.html",controller:"newActivityUCtrl",
resolve:{loadCtrl:f("app/components/ide/newActivityU.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}],lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("multipleSelect")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin]}}).state("home.assignments",{url:"^/home/assignments/{idGroup:int}/{idAssignment:int}",templateUrl:"app/components/assign/assignments.html",controller:"AssignmentsController",resolve:{loadCtrl:f("assignmentsCtrl"),lazyModules_datetime:["$ocLazyLoad",
function(a){return a.load("ui.bootstrap.datetimepicker")}],lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("fxpicklist")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin]}}).state("home.assignments.assign",{url:"^/home/assignments/{idGroup:int}/{idAssignment:int}/assign/{idActivity:int}",templateUrl:"app/components/assign/assign.html",controller:"AssignController",resolve:{loadCtrl:f("assignCtrl"),lazyModules_datetime:["$ocLazyLoad",function(a){return a.load("ui.bootstrap.datetimepicker")}],
lazyModules_picklist:["$ocLazyLoad",function(a){return a.load("fxpicklist")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin]}}).state("home.activitytrace",{url:"^/home/activitytrace/{idActivity:int}/{idAssignment:int}/{idGroup:int}",templateUrl:"app/components/activity/activityTrace.html",controller:"ActivityTraceController",resolve:{loadCtrl:f("app/components/activity/activityTrace.js")}}).state("home.unittrace",{url:"^/home/unittrace/{idUnit:int}",templateUrl:"app/components/activity/unitTrace.html",
controller:"UnitTraceController",resolve:{loadCtrl:f("app/components/activity/unitTrace.js"),lazyModules_ngprint:["$ocLazyLoad",function(a){return a.load("AngularPrint")}],AutoRenderer:["$q","Session",function(a,b){var d=a.defer();require(["katexauto","/activities/libs/activity-autorender.js"],function(a){b.addCss(pw.KATEXCSS);window.renderMathInElement=window.renderMathInElement||a;d.resolve()});return d.promise}]}}).state("home.sheet",{url:"^/home/sheet/{idActivities}",templateUrl:"app/components/activity/activitySheet.html",
controller:"ActivitySheetCtrl",resolve:{loadCtrl:f("activitySheetCtrl"),lazyModules_ngprint:["$ocLazyLoad",function(a){return a.load("AngularPrint")}]}}).state("home.ide",{url:"^/home/ide/{idActivity}",templateUrl:"app/components/ide/activityIde.html",controller:"ActivityIdeCtrl",resolve:{loadCtrl:f("activityIdeCtrl"),lazyModules_ace:["$ocLazyLoad",function(a){return a.load("ui.ace")}],lazyModules_tree:["$ocLazyLoad",function(a){return a.load("ui.tree")}]},data:{authorizeRoles:[b.admin,b.teacher,
b.teacheradmin],authStateParams:!0}}).state("home.ide.run",{url:"^/home/ide/{idActivity}/run",templateUrl:"app/components/activity/activity.html",controller:"ActivitySimpleCtrl",resolve:{loadCtrl:f("activitySimpleCtrl")},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin],authStateParams:!1}}).state("home.unauthorized",{url:"^/home/unauthorized",templateUrl:"app/shared/unauthorized-tpl.html",controller:["$scope","$interval","$state",function(a,b,d){a.count=5;var e;e=b(function(){--a.count;0===
a.count&&(b.cancel(e),a.goHome())},1E3);a.goHome=function(){d.go("home")}}]}).state("home.center",{url:"^/home/center",templateUrl:"app/components/admin/center.html",controller:"CenterCtrl",data:{authorizeRoles:[b.teacheradmin]},resolve:{loadCtrl:f("/app/components/admin/centerCtrl.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}]}}).state("home.bookmgr",{url:"^/home/bookmgr",templateUrl:"app/components/admin/bookmgr.html",controller:"BookMgrCtrl",data:{authorizeRoles:[b.teacheradmin]},
resolve:{loadCtrl:f("/app/components/admin/bookmgrCtrl.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}],lazyModules_datetime:["$ocLazyLoad",function(a){return a.load("ui.bootstrap.datetimepicker")}]}}).state("home.centers",{url:"^/home/centers",templateUrl:"app/components/admin/centers.html",controller:"CentersCtrl",data:{authorizeRoles:[b.admin]},resolve:{loadCtrl:f("/app/components/admin/centersCtrl.js"),lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}]}}).state("home.news",
{url:"^/home/news",templateUrl:"app/components/admin/news.html",controller:"newsCtrl",data:{authorizeRoles:[b.admin]},resolve:{loadCtrl:f("/app/components/admin/newsCtrl.js"),lazyModules_datetime:["$ocLazyLoad",function(a){return a.load("ui.bootstrap.datetimepicker")}]}}).state("home.challenges",{url:"^/home/challenges",templateUrl:"app/components/admin/challenges.html",controller:"ChallengesCtrl",data:{authorizeRoles:[b.admin,b.teacheradmin]},resolve:{loadCtrl:f("/app/components/admin/challengesCtrl.js"),
lazyModules_datetime:["$ocLazyLoad",function(a){return a.load("ui.bootstrap.datetimepicker")}],lazyModules_toggle:["$ocLazyLoad",function(a){return a.load("nzToggle")}]}}).state("home.tools",{url:"^/home/tools",templateUrl:"app/components/misc/tools.html",controller:"ToolsCtrl",resolve:{loadCtrl:f("/app/components/misc/toolsCtrl.js")}}).state("home.help",{url:"^/home/help",templateUrl:"app/components/misc/help.html",controller:"HelpCtrl",resolve:{loadCtrl:f("/app/components/misc/helpCtrl.js"),lazyModules_hljs:["$ocLazyLoad",
function(a){return a.load("hljs")}]}}).state("home.forum",{url:"^/home/forum",templateUrl:"app/components/misc/forum.html",controller:"ForumCtrl",resolve:{loadCtrl:f("/app/components/misc/forumCtrl.js"),lazyModules_tinymce:["$ocLazyLoad",function(a){return a.load("ui.tinymce")}]}}).state("home.notebook",{url:"^/home/notebook",templateUrl:"app/components/misc/notebook.html",controller:"NotebookCtrl",resolve:{loadCtrl:f("/app/components/misc/notebookCtrl.js"),lazyModules_ace:["$ocLazyLoad",function(a){return a.load("ui.ace")}],
lazyModules_ngFileUpload:["$ocLazyLoad",function(a){return a.load("ngFileUpload")}]},data:{authorizeRoles:[b.admin,b.teacher,b.teacheradmin]}}).state("home.activitysearch",{url:"^/home/activitysearch",templateUrl:"app/components/activity/activitySearch.html",controller:"ActivitySearchController",resolve:{ctrl:f("app/components/activity/activitySearch.js")}}).state("home.activity",{url:"^/home/activity/{idActivity:int}/{idAssignment:int}?autoplay",templateUrl:"app/components/activity/ActivityPre.html",
controller:"ActivityPreCtrl",resolve:{ctrl:f("app/components/activity/ActivityPreCtrl.js"),lazyModules_ngFileUpload:["$ocLazyLoad",function(a){return a.load("ngFileUpload")}]}}).state("home.activity.review",{url:"^/home/activity/{idActivity:int}/{idAssignment:int}/review/{idAttempt}",templateUrl:"app/components/activity/activityReview.html",controller:"ActivityReviewCtrl",resolve:{loadCtrl:f("activityReviewCtrl")}})}])})(window.pw.app,angular);(function(k,m){k.config(["$translateProvider",function(a){a.useCookieStorage();a.useUrlLoader("/rest/i18n/lang");a.useSanitizeValueStrategy(null);a.preferredLanguage(navigatorLang()||"ca")}])})(window.pw.app,angular);(function(k,m){k.controller("LoginController",["$scope","$rootScope","$state","growl","$http","$translate","Auth","USER_ROLES","Modals","$uibModal","$location",function(a,f,b,d,e,c,l,g,h,k,m){function w(){var c=localStorage.getItem("cachedRouteTo");c?(c=JSON.parse(c),b.go(c.name,c.params),localStorage.removeItem("cachedRouteTo")):a.user.idRole===g.parents?(console.log("going to home parents"),b.go("home.parents")):(console.log("going to home"),b.go("home"))}a.version=window.pw.PW_VERSION;a.lang=navigatorLang()||
"ca";a.lang.indexOf("-")&&(a.lang=a.lang.substring(0,a.lang.indexOf("-")));0>["ca","es","en"].indexOf(a.lang)&&(a.lang="es");var B;a.isMobile=window.pw.isMobile()&&localStorage;c.use(a.lang);a.credentials={username:"",password:"",parents:!1};if(a.isMobile){var q=localStorage.getItem("pwMobile");if(q)try{var x=JSON.parse(pw.decrypt(q));a.credentials.username=x.username||"";a.credentials.password=x.password||""}catch(z){}}a.beanOpts={canAdd:!0,canDel:!0,readonly:{str:!0,complex:{im:{alpha:!0}}}};a.error=
"";a.hideAlert=!0;a.enroll={id:"",password:"",name:"",surname:"",email:"",phone:"",upassword:"",urepassword:""};a.showRegistrationForm=!1;a.registrationCenter={};a.guestSession={is:!1,gsClosed:!1};a.slides=[];a.go=function(b,c){a.username=b;a.password=c;a.parents=!1;a.login()};a.changeLanguage=function(b){a.lang=b;c.use(b);f.$broadcast("changeLang",b)};var t=function(){var b=a.user.idRole===g.parents,c=k.open({templateUrl:"app/components/home/changepwd-dlg.html",controller:["$scope",function(b){b.pwd=
"";b.newpwd="";b.newpwd2="";b.username=a.user.username;b.hideoldpwd=!0;b.ok=function(){if(6>b.newpwd.trim().length)d.error("La longitud m\u00ednima de la contrasenya s\u00f3n 6 car\u00e0cters.");else if(b.newpwd.trim()===a.user.email.trim())d.error("La constrasenya ha d'esser diferent que el correu electr\u00f2nic");else{var e=/[0-9]/;e.test(b.newpwd)?(e=/[a-z]/,e.test(b.newpwd)?b.newpwd!==b.newpwd2?d.error("Les contrasenyes no coincideixen."):c.close(b.newpwd):d.error("La contrasenya ha de contenir almenys una lletra min\u00fascula (a-z)!")):
d.error("La constrasenya ha de contenir almenys un nombre (0-9)!")}};b.cancel=function(){c.dismiss()}}],size:"md"});c.result.then(function(c){var g={idUser:a.user.id};b?g.passwordParents=c:g.password=c;e({method:"post",url:"/rest/auth/changepwd",data:pw.encrypt(JSON.stringify(g)),headers:{"Content-Type":"text/plain;charset=UTF-8"}}).then(function(c){c.data.ok?(h.notificationdlg("Nova contrasenya","S'ha canviat satisfact\u00f2riament la contrasenya"+(b?" d'acc\u00e9s fam\u00edlia.":".")),w(),a.user.mustChgPwd=
0):(d.warning("Ho sentim per\u00f2, no s'ha pogut canviar la contrasenya."),a.loading=!1)})},function(){a.loading=!1})};a.login=function(){a.error="";a.hideAlert=!0;a.loading=!0;l.login(a.credentials,function(f){a.user=f;console.log(f);if(f.idRole===g.guest)b.go("home.activitysearch");else if(h.resetLatency(),"root"!==a.credentials.username&&a.isMobile&&!B&&localStorage.setItem("pwMobile",pw.encrypt(JSON.stringify(a.credentials))),f.language&&c.use(f.language),f.idRole===g.parents&&f.uopts.parentsMailLang&&
c.use(f.uopts.parentsMailLang),jQuery("#bowser-alert").hide(100),f.mustChgPwd&&f.idRole!==g.parents)a.loading=!1,t();else if(f.config.requireEmail&&f.idRole!==g.admin&&!f.email&&f.idRole!==g.parents){var l=k.open({templateUrl:"app/components/login/linkmail.html",controller:["$scope","$timeout",function(a,b){a.ok=function(){a.email&&pw.testEmail(a.email)?l.close(a.email):a.err=!0};a.email="";a.username=f.username;b(function(){jQuery("#emailbox").focus()})}],size:"md"});l.result.then(function(b){w();
b&&e.post("/rest/auth/linkmail",{idUser:a.user.id,username:a.user.username,fullname:a.user.fullname,email:"??"+b}).then(function(c){c.data.ok?d.notify("Comproveu el vostre correu electr\u00f2nic i seguiu les instruccions per acabar el proc\u00e9s.",{title:"Correu vinculat: "+b,ttl:-1}):(d.error(c.data.msg),a.loading=!1)})},function(){a.loading=!1})}else"??"===f.email.substring(0,2)&&d.notify("Comproveu el vostre correu electr\u00f2nic i seguiu les instruccions per acabar el proc\u00e9s.",{title:"Correu vinculat: "+
f.email.substring(2),ttl:-1}),w()},function(b){console.log(b);a.credentials.password="";a.error=b;a.hideAlert=!1;a.loading=!1})};a.guest=function(){a.credentials.username="guest";a.credentials.password="guest18";a.login()};a.goLogin=function(){a.error="";a.hideAlert=!0;a.guestSession={is:!1,gsClosed:!0};b.go("login")};a.prenroll=function(){e.post("/rest/auth/prenroll",{enroll:a.enroll}).then(function(b){b=b.data;b.ok?(a.showRegistrationForm=!0,a.registrationCenter=b):(a.enroll.id="",d.error("Les dades del centre s\u00f3n incorrectes o b\u00e9 no accepta inscripcions. Consulteu al professor responsable."))})};
a.cancel_enroll=function(){a.enroll={id:"",password:"",name:"",surname:"",email:"",upassword:"",urepassword:""};a.showRegistrationForm=!1};a.do_enroll=function(){if(a.enroll.name.trim())if(a.enroll.surname.trim())if(!a.enroll.email.trim()||0>a.enroll.email.indexOf("@"))d.error("Cal que escriviu un correu electr\u00f2nic correcte.");else if(a.enroll.phone.trim())if(6>a.enroll.upassword.trim().length)d.error("La longitud m\u00ednima de la contrasenya s\u00f3n 6 car\u00e0cters.");else if(a.enroll.upassword.trim()===
a.enroll.email.trim())d.error("La constrasenya ha d'esser diferent que el correu electr\u00f2nic");else{var b=/[0-9]/;b.test(a.enroll.upassword)?(b=/[a-z]/,b.test(a.enroll.upassword)?a.enroll.upassword!==a.enroll.urepassword?d.error("Les contrasenyes no coincideixen."):(b=function(a){return a.replace(/\w\S*/g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()})},a.enroll.email=a.enroll.email.toLowerCase().trim(),a.enroll.name=b(a.enroll.name).trim(),a.enroll.surname=b(a.enroll.surname).trim(),
a.enroll.idRole=g.student,a.enroll.schoolId=a.registrationCenter.schoolId,e.post("/rest/auth/doenroll",{enroll:a.enroll}).then(function(b){b.data.ok?(a.enroll={id:"",password:"",name:"",surname:"",email:"",phone:"",upassword:"",urepassword:""},h.notificationdlg("","Comproveu el vostre correu electr\u00f2nic i seguiu les instruccions per completar la inscripci\u00f3. Teniu 24 h per fer-ho. Gr\u00e0cies"),a.showRegistrationForm=!1):d.error("S'ha produit un error. Possiblement un usuari amb el mateix email ja estigui registrat.")})):
d.error("La contrasenya ha de contenir almenys una lletra min\u00fascula (a-z)!")):d.error("La constrasenya ha de contenir almenys un nombre (0-9)!")}else d.error("Cal que escriviu un codi de recuperaci\u00f3 de contrasenya.");else d.error("Cal que escriviu els llinatges.");else d.error("Cal que escriviu un nom.")};a.forgotPassword=function(){var a=k.open({templateUrl:"app/components/login/forgotpwd-dlg.html",controller:["$scope",function(b){b.ok=function(){b.bean.email&&b.bean.email.trim()&&b.bean.phone&&
b.bean.phone.trim()?a.close(b.bean):d.warning("No es pot deixar cap dels camps buits.")};b.cancel=function(){a.dismiss()};b.bean={email:"",phone:""}}],size:"md"});a.result.then(function(a){e.post("/rest/auth/forgotpwd",a).then(function(a){a.data.ok?h.notificationdlg("Nova contrasenya","Comproveu el vostre correu electr\u00f2nic."):d.warning(a.data.msg)})})};e.post("/rest/news/list",{filter:!0,badges:!0}).then(function(b){a.slides=b.data;jQuery("#uname").focus()},function(a){console.log(a);m.url("nodatabase.html")});
a.clearLocalStorage=function(){localStorage.removeItem("pwMobile");a.credentials.username="";a.credentials.password="";B=!0};f.adjustPadding()}])})(window.pw.app,angular);
});
