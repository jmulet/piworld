define(["katex"],function(n){window.katex=window.katex||n;var f=window.pw||{},p=function(e){this.context=e;var c=document.createElement("iframe");this.iframe=c;c.style||(c.style={});c.style.display="none";document.body.appendChild(c);var b=c.contentWindow;Object.defineProperty(b.Array.prototype,"random",{value:function(){return this[b.Math.floor(b.Math.random()*this.length)]}});b.Array.prototype.shuffle=function(){var a=this.length,g,c;if(0===a)return this;for(;--a;)g=b.Math.floor(b.Math.random()*
(a+1)),c=this[a],this[a]=this[g],this[g]=c;return this};b.Math.ln=function(a){return b.Math.log(a)/b.Math.LOG10E};b.Math.logb=function(a,g){return b.Math.log(a)/b.Math.log(g||10)};b.Math.root=function(a,g){return b.Math.pow(a,1/g)};b.Math.srandom=function(){return b.Math.random().toString(36).slice(2)};b.Math.irandom=function(a,g){a=a||0;g=g||10;return b.Math.floor(b.Math.random()*(g-a))+a};b.Math.seed=function(a){this.seed=a;this.random=function(a){a=a||1;for(var b=Array(a),c=0;c<a;c++)this.seed=
(9301*this.seed+49297)%233280,b[c]=this.seed/233280;return 1<a?b:b[0]};return this};b.Math.fact=function(a){return"number"!==typeof a||0>a?!1:0===a?1:a*b.Math.fact(a-1)};b.Math.binomial=function(a,b){if("number"!==typeof a||"number"!==typeof b||a<b)return!1;for(var c=1,e=a-b+1;e<=a;e++)c*=e;for(e=1;e<=b;e++)c/=e;return c};this.win=b;this.win.onbeforeunload=function(){c.src="about:blank"};this.wEval=b.eval;this.wExecScript=b.execScript;!this.wEval&&this.wExecScript&&(this.wExecScript.call(b,"null"),
this.wEval=b.eval);for(var f=Object.keys(this.context),k=f.length,a=0;a<k;a++){var m=f[a];b[m]=e[m]}this.globals=Object.keys(b)};p.prototype.runInContext=function(e){var c;try{c=this.wEval.call(this.win,e)}catch(b){console.log(b,e)}e=Object.keys(this.win);for(var f=e.length,k=0;k<f;k++){var a=e[k];0>this.globals.indexOf(a)&&(this.context[a]=this.win[a])}return c};p.prototype.destroy=function(){document.body.removeChild(this.iframe);this.win=this.wExecScript=this.wEval=null};f.Script=p;f.katexMacros=
{"\\Re":"\\mathbb{R}","\\alf":"\\alpha","\\tg":"\\mathrm{tg}\\,","\\arctg":"\\mathrm{arctg}\\,","\\cotg":"\\mathrm{cotg}\\,","\\cosec":"\\mathrm{cosec}\\,"};var s=RegExp("\\${1,2}([\\s\\S]*?)\\${1,2}","g"),t=RegExp("\\\\\\[([\\s\\S]*?)\\\\\\]","g");f.katexParser=function(e,c){if(!e)return e;var b={displayMode:!1,macros:f.katexMacros};c=c||{};var l=e.replace(s,function(e,a,f,l){a=a||e;var g;try{g=n.renderToString(a,b)}catch(r){console.log("Can't process KATEX: ",a),g='<span style="color: red; font-style: italic;">'+
a+"</span>"}c.isJSON&&(g=g.replace(/"/g,'\\"').replace(/\n/g,"").replace(/\t/g,"").replace(/[^\0-\xFF]/g,""));return g});b.displayMode=!0;return l=l.replace(t,function(e,a,f,l){a=a||e;var g;try{g=n.renderToString(a,b)}catch(r){console.log("Can't process KATEX: ",a),g='<span style="color: red; font-style: italic;">'+a+"</span>"}c.isJSON&&(g=g.replace(/"/g,'\\"').replace(/\n/g,"").replace(/\t/g,"").replace(/[^\0-\xFF]/g,""));return g})};var q=RegExp("\\{{2}([\\s\\S]*?)\\}{2}","g");f.Template=function(e,
c){if(!e)return e;var b=e||"",f="",k=0,a="",m=b.replace(q,function(b,c){var e="__nv_"+Math.random().toString(36).substring(2)+"__";f+=e+"="+c+"; ";k+=1;a=e;return"{{"+e+"}}"});if(f){c.runInContext(f);if(1===k&&"string"!==typeof c.context[a])return c.context[a];b=m.replace(q,function(a,b){return c.context[b]?c.context[b]+"":a})}return b};f.BakeJson=function(e,c,b){var l=Array(10),k={iran:function(a,b){return Math.floor((b-a)*Math.random())+a},Alea:f.Alea,idUser:b};c&&$.each(Object.keys(c),function(a,
b){k[b]=c[b]});var a=new f.Script(k),m=10,n=0;$.each(e,function(b,c){for(var e=c.repeat||1,p=0;p<e;p++){var d=$.extend(!0,{},c);d.level=d.level||1;10<d.level&&(d.level=10);d.level<m&&(m=d.level);d.level>n&&(n=d.level);d.scope&&d.scope.trim()&&a.runInContext(d.scope);d.formulation=f.Template(d.formulation,a);d.subformulation=f.Template(d.subformulation,a);d.hints=f.Template(d.hints,a);d.feedback=f.Template(d.feedback,a);if(d.validate){var h=Math.random().toString(36).slice(2),h="__validate_fn_"+h+
"__";a.runInContext(h+"="+d.validate.replace(/\{\{/g,"").replace(/\}\}/g,""));d.validate=k[h]}d.check&&(h=Math.random().toString(36).slice(2),h="__check_fn_"+h+"__",a.runInContext(h+"="+d.check.replace(/\{\{/g,"").replace(/\}\}/g,"")),d.check=k[h]);if(Array.isArray(d.answer))for(h=0;h<d.answer.length;h++)"string"===typeof d.answer[h]&&(d.answer[h]=f.Template(d.answer[h],a));else d.answer=f.Template(d.answer,a);d.checkOpts=d.checkOpts||{};d.options&&("string"===typeof d.options?d.options=f.Template(d.options,
a):$.isArray(d.options)&&$.each(d.options,function(b,c){c.text=f.Template(c.text,a);if("string"===typeof c.valid){var d=c.valid,e="__valid_"+Math.random().toString(36).slice(2)+"__";a.runInContext(e+"="+d.replace(/\{/g,"").replace(/\}/g,""));c.valid=k[e]}}));h=l[d.level-1];h||(h=[],l[d.level-1]=h);h.push(d)}});a.destroy();return l.filter(function(a){return"undefined"!==typeof a})};f.BrewJS=function(e){var c={},b=new f.Script(c);b.runInContext(e);b.destroy();if(c.brewed&&c.brewed.then)return c.brewed;
e=new $.Deferred;e.resolve([]);return e.promise()}});
