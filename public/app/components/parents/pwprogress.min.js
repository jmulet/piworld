
define([],function(){window.pw.app.register.controller("PwProgressController",["$http","$scope","$rootScope","$filter","$transition$","$uibModal","growl","$translate","Session","PwTable","$state",function(k,m,l,j,c,f,g,e,h,i,b){m.user=h.getUser();var d=function(r,q,p){if(!r.length){return[0,1,1,0]}var o=r[0];var n=q[0];var t=o+1;var s=n+1;r.forEach(function(u){if(u>t){t=u}if(u<o){o=u}});q.forEach(function(u){if(u>s){s=u}if(u<n){n=u}});if(p){p.forEach(function(u){if(u>s){s=u}if(u<n){n=u}})}return[o,s,t,n]};m.tableParams=new i({count:10,sorting:["+dia"]},function(n,o){if(m.user){k.post("/rest/students/statistics",{idAlumne:m.user.id}).then(function(p){var q=p.data.detail;n.resolve(q)})}else{n.resolve([])}});m.tableParams2=new i({count:10,sorting:["-login"]},function(n,o){if(m.user){k.post("/rest/auth/loginlist",{idUser:m.user.id}).then(function(p){m.loginData=p.data;n.resolve(p.data.logins)})}else{n.resolve([])}});var a=[false,false,false];m.lazy=function(n){if(!a[n]){a[n]=true;if(n===0){m.tableParams.reload()}else{if(n===1){m.tableParams2.reload()}else{m.showScore(m.user)}}}};m.detall=function(n){b.go("home.activity.review",{idActivity:n.idActivity,idAssignment:n.idAssignment,idAttempt:n.idAttempt})};m.showScore=function(n){m.tab2$loading=true;k.post("/rest/students/categoryscores",{idUser:n.id}).then(function(o){var p=o.data;p.rscore=0;jQuery.each(p.badges,function(q,s){p.rscore+=s.rscore;var t=l.badgeDescription(s.type);var r=e.instant("SCORE");s.html="<div><p>"+t+"</p> <p>"+j("date")(s.day,"dd-MM-yyyy")+"<p><p>"+s.rscore+" "+r+"</p></div>"});m.myScores=p;m.tab2$loading=false})};m.quizzDetail=function(n){k.post("/rest/video/vdetail",{idV:n.idV}).then(function(p){var o=f.open({templateUrl:"app/components/students/video-detail.html",controller:["$scope","modalParams",function(r,q){r.title=q.title;r.data=q.data;r.cpwd="";r.invalidpwd="";r.ok=function(){o.close("ok")};r.cancel=function(){o.dismiss("cancel")}}],resolve:{modalParams:function(){return{title:"Video "+n.resource,data:p.data}}}})})};a=[false,false,false];m.lazy(m.active);m.myFilter=function(n){if(!m.filterNames){return true}return(n.fullname||"").toLowerCase().indexOf(m.filterNames.toLowerCase())>=0}}])});