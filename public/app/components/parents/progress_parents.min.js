
define(["https://www.gstatic.com/charts/loader.js","jquery-draggable","mobile-dnd"],function(){function c(k){var l=/\S+@\S+\.\S+/;return l.test(k)}var d={FA:400,RE:401,ATTENDANCE:[400,401],HOMEWORK:[200,201,300],CLASSWORK:[202,203,304],BEHAVIOUR:[303,302,301,204,205,305]};var f={ca:{1:"Comentaris",2:"Regularitat",3:"Millor de la setmana",4:"Millor del mes",5:"Repte de la setmana",50:"Guanyador d'un Kahoot",100:"Especial de Nadal",101:"Especial de Pasqua",200:"Deures fets completament",201:"Deures fets",202:"Treballa molt bé en classe ",203:"Treballa en classe",204:"Participa, presta atenció",205:"Surt a la pissarra",300:"No ha fet els deures",301:"Xerra i/o molesta",302:"No duu el material necessari",303:"Falta greu de comportament",304:"No treballa a classe",305:"Passiu, no presta atenció",400:"Falta a classe",401:"Falta puntualitat"},es:{1:"Comentarios",2:"Regularidad",3:"Mejor de la semana",4:"Mejor del mes",5:"Reto de la setmana",50:"Ganador de un Kahoot",100:"Especial de Navidad",101:"Especial de Pascua",200:"Deberes hechos correctamente",201:"Deberes hechos",202:"Trabaja muy bien en clase",203:"Trabaja en clase",204:"Participa, presta atención",205:"Sale a la pizarra",300:"No ha hecho los deberes",301:"Habla y/o molesta",302:"No trae el material necesario",303:"Falta grave de comportamiento",304:"No trabaja en clase",305:"Passivo, no presta atención",400:"Falta a clase",401:"Falta de puntualidad"},en:{1:"Comments",2:"Regularity",3:"Best of the week",4:"Best of the month",5:"Week challenge",50:"Kahoot winner",100:"Xmas special badge",101:"Easter special badge",200:"Homework correctly done",201:"Homework done",202:"Works very well in class",203:"Works in class",204:"Participates, pays attention",205:"Blackboard exercise",300:"Homework not done",301:"Speaks and / or annoys",302:"Does not bring the required material",303:"Very bad behaviour",304:"Does not work in class",305:"Passive, does not pay attention",400:"Class absence",401:"Late to class"}};var e="ca";var j={ca:{PENDING:"Pendent",NOGRADE:"No avaluat",DAYNAME:["Dl","Dt","Dm","Dj","Dv"],DEARFAMILY:"Benvolguda família de l'alumne/a",AYWF:"Us faig arribar el resum setmanal de la matèria",BESTWISHES:"Atentament",DAY:"Dia",TERM:"Avaluació",ACTIVITY:"Activitat",GRADE:"Nota",GRADES:"Notes",MESSAGES:"Missatges",SUBJECTEMAIL:"Seguiment. Setmana",FURTHERINFO:"Recordau que podeu consultar en qualsevol moment la informació a través del portal <a href='https://piworld.es'>https://piworld.es</a> amb les credencials que us varem propocionar",FURTHERINFO2:"Recordau que podeu consultar en qualsevol moment la informació a través del portal https://piworld.es amb les credencials que us varem propocionar",SUMMARY:"Resum",SUBJECT:"Matèria",NODAY:"Cap dia",NEVER:"Mai",WEEKPROGRESS:"Evolució setmanal",ITEM:"Aspecte",FA:"Falta a classe",RE:"Retard",HOMEWORK:"Deures",CLASSWORK:"Feina a classe",BEHAVIOUR:"Comportament",NOHOMEWORK:"No duu els deures",NOCLASSWORK:"No fa feina a classe",BADBEHAVIOUR:"Mal comportament",GRADE0:"No avaluat o nota neutre",GRADEN:"Nota negativa",GRADEP:"Nota positiva",PROGRESSOF:"Seguiment de l'alumne/a",INSUBJECT:"en la matèria",OFYEAR:"del curs",MEANING:"Significat",FREQUENCY:"Freqüència",MESSAGE:"Missatge",CHECKEMAIL:"Reviseu el camp correu electrònic.",CONFIGUPDATED:"S'ha desat la configuració",CONFIGERROR:":-(  Upps! No s'han pogut desar la configuració.",NOACTIVITIES:"No s'han trobat activitats",NOMESSAGES:"No hi ha missatges"},es:{PENDING:"Pendiente",NOGRADE:"No evaluado",DAYNAME:["Lu","Ma","Mi","Ju","Vi"],DEARFAMILY:"Querida familia del alumno/a",AYWF:"Les mando un resumen semanal de la materia",BESTWISHES:"Atentamente",DAY:"Día",TERM:"Evaluación",ACTIVITY:"Actividad",GRADE:"Nota",GRADES:"Notas",MESSAGES:"Mensajes",SUBJECTEMAIL:"Seguimento. Setmana",FURTHERINFO:"Recordad que podeis consultar en cualquier momento la información a través del portal <a href='https://piworld.es'>https://piworld.es</a> con las credenciales que os dimos",FURTHERINFO2:"Recordad que podeis consultar en cualquier momento la información a través del portal https://piworld.es con las credenciales que os dimos",SUMMARY:"Resumen",SUBJECT:"Materia",NODAY:"Ningun dia",NEVER:"Nunca",WEEKPROGRESS:"Evolución semanal",ITEM:"Aspecto",FA:"Falta a clase",RE:"Retraso",HOMEWORK:"Deberes",CLASSWORK:"Trabaja a classe",BEHAVIOUR:"Comportamiento",NOHOMEWORK:"No trae los deberes",NOCLASSWORK:"No trabaja en clase",BADBEHAVIOUR:"Mal comportamiento",GRADE0:"No evaluado o nota neutra",GRADEN:"Nota negativa",GRADEP:"Nota positiva",PROGRESSOF:"Seguimento del alumno/a",INSUBJECT:"en la materia",OFYEAR:"del curso",MEANING:"Significado",FREQUENCY:"Frecuencia",MESSAGE:"Mensaje",CHECKEMAIL:"Revisad el campo correo electrónico.",CONFIGUPDATED:"Se ha guardado la configuración",CONFIGERROR:":-(  Upps! No se ha podido guardar la configuración",NOACTIVITIES:"No se han encontrado actividades",NOMESSAGES:"No hay mensajes"},en:{PENDING:"Pending",NOGRADE:"No grade",DAYNAME:["Mo","Tu","Wd","Th","Fr"],DEARFAMILY:"Dear family of the student",AYWF:"Attached you will find a weekly summary of the subject",BESTWISHES:"Best wishes",DAY:"Day",TERM:"Term",ACTIVITY:"Activity",GRADE:"Grade",GRADES:"Grades",MESSAGES:"Messages",SUBJECTEMAIL:"Progress. Week",FURTHERINFO:"Please remember that you will find further information at <a href='https://piworld.es'>https://piworld.es</a>. Login credentials are required",FURTHERINFO2:"Please remember that you will find further information at https://piworld.es. Login credentials are required",SUMMARY:"Summary",SUBJECT:"Subject",NODAY:"Never",NEVER:"Never",WEEKPROGRESS:"Weekly progress",ITEM:"Item",FA:"Class absences",RE:"Late to class",HOMEWORK:"Homework",CLASSWORK:"Classwork",BEHAVIOUR:"Behaviour",NOHOMEWORK:"No homework handed",NOCLASSWORK:"No work at class",BADBEHAVIOUR:"Bad behaviour",GRADE0:"No grade or neutral grade",GRADEN:"Negative grade",GRADEP:"Positive grade",PROGRESSOF:"Progress of student",INSUBJECT:"in the subject",OFYEAR:"of the academic year",MEANING:"Meaning",FREQUENCY:"Frequency",MESSAGE:"Message",CHECKEMAIL:"Please check email field",CONFIGUPDATED:"The configuration has been saved",CONFIGERROR:":-(  Upps! An error occurred while saving the configuration",NOACTIVITIES:"No activities found",NOMESSAGES:"There are no messages"}};var g=function(l,m){var k=j[m]||j[e];return k[l]||l};var b=function(k){if(typeof(k)==="string"){this.date=new Date(k)}else{this.date=k}};b.prototype={mysql:function(){return this.date.toISOString().slice(0,10).replace("T"," ")},local:function(){var k=this.date.toLocaleString().split(",");return k[0]},curt:function(k){if(!k){k="/"}if(!this.date){return""}return this.date.getDate()+k+(this.date.getMonth()+1)+k+this.date.getFullYear()},parse:function(t,q,p){if(!p){if(t.indexOf("/")>0){p="/"}else{p="-"}}q=q||"dd"+p+"mm"+p+"yyyy";var r=q.toLowerCase();var n=r.split(p);var m=t.split(p);var o=n.indexOf("mm");var k=n.indexOf("dd");var l=n.indexOf("yyyy");var s=parseInt(m[o]);s-=1;this.date=new Date(m[l],s,m[k]);this.date.setHours(12);return this}};var h=(2000+pw.currentYear)+"-09-10";var a=(2001+pw.currentYear)+"-09-10";var i=function(k,l){l=l||"ca";if(k>=0){return k}else{if(k===-1){return g("PENDING")}else{if(k===-2){return g("NOGRADE")}}}return""};window.pw.app.register.factory("ParentsRest",function(){var k={badges:function(l,n,m,p){var o={idUser:l,idGroup:n||0,day:m,day2:p};return $.ajax({type:"POST",url:"/rest/badges/list",data:JSON.stringify(o),contentType:"application/json"})},listActivities:function(n,m,l,q,p){var o={idCreator:n,idGroup:m,idUser:l,day:q,day2:p,visible:1};return $.ajax({type:"POST",url:"/rest/pda/activities/list",data:JSON.stringify(o),contentType:"application/json"})},listComments:function(o,l,m){var n={idUser:o,isFor:l,idGroup:m,parents:1,xatGroup:1};return $.ajax({type:"POST",url:"/rest/chats/list",data:JSON.stringify(n),contentType:"application/json"})}};return k});window.pw.app.register.controller("ParentsProgressController",["$scope","$rootScope","Session","ParentsRest","$timeout","$translate","$uibModal","$http","growl",function(x,v,r,m,n,k,o,u,p){x.status={};x.user=r.getUser();var w=x.user.groups[0];x.selectedGroup=w;var l=x.user.uopts.parentsMailLang;if(l){k.use(l)}x.i18n={};x.internationalize=function(){var z=k.use();var y=j[z]||j.ca;$.each(Object.keys(y),function(B,A){x.i18n[A]=y[A]||A})};x.internationalize();x.logout=function(){r.logout()};google.charts.load("current",{packages:["calendar"]});google.charts.setOnLoadCallback(q);function q(){$("#view-informes-calendars").show();t()}x.hideDetails=function(){x.selectedDay=null;$("#badgeDetail").css("visibility","hidden")};x.badgeDescription=function(y){var A=k.use();var z="Badge";return(f[A]||{})[y]||z};x.update=function(y){x.selectedGroup=y;h=(2000+y.groupYear)+"-09-10";a=(2001+y.groupYear)+"-09-10";w=y;x.selectedDay=null;$("#badgeDetail").css("visibility","hidden");q()};v.$on("changeLang",function(y){x.internationalize();q()});var s=function(A,F,H,z,C,E){var B=new google.visualization.DataTable();B.addColumn({type:"date",id:"Date"});B.addColumn({type:"number",id:"Aspect"});B.addRows(H);var D=new google.visualization.Calendar(document.getElementById(A));var G={title:F,height:350,calendar:{daysOfWeek:"DLMMJVS"},colorAxis:{minValue:C,maxValue:E}};D.draw(B,G);if(z){var y=function(){var I=D.getSelection();if(I.length&&I[0].row>=0){var L=I[0].row;var J=new b(new Date(I[0].date)).curt();var K=z[L];n(function(){x.selectedDay={date:J,list:K};$("#badgeDetail").css("visibility","")})}else{n(function(){x.selectedDay=null;$("#badgeDetail").css("visibility","hidden")})}};google.visualization.events.addListener(D,"select",y)}};function t(){var y=x.user;var z=new b(new Date()).mysql();m.badges(y.id,w.idGroup,h,z).then(function(Y){var S=[];var Q={};var P={};var N={};var K={};var J={};var I={};var E=[];var M=[];var O=[];var X=[];var F=0;var G=0;var L=0;var B=0;var D=0;$.each(Y,function(ab,ae){if(ae.type>=200){var aa=new Date(ae.day);var ac=aa.getFullYear();if(M.indexOf(ac)<0){M.push(ac)}if(E.indexOf(ae.day)<0){E.push(ae.day)}var af=new Date(ae.day);if(d.ATTENDANCE.indexOf(ae.type)>=0){if(ae.type===400){F+=1}else{G+=1}S.push([af,ae.rscore])}else{if(d.CLASSWORK.indexOf(ae.type)>=0){if(O.indexOf(ae.day)<0){O.push(ae.day)}var ad=Q[ae.day];if(!ad){ad=[af,0];Q[ae.day]=ad}if(ae.rscore<0){B+=1}ad[1]+=ae.rscore;var ag=K[ae.day];if(!ag){ag=[];K[ae.day]=ag}ag.push(ae)}else{if(d.HOMEWORK.indexOf(ae.type)>=0){if(X.indexOf(ae.day)<0){X.push(ae.day)}var ad=P[ae.day];if(!ad){ad=[af,0];P[ae.day]=ad}if(ae.rscore<0){L+=1}ad[1]+=ae.rscore;var ag=J[ae.day];if(!ag){ag=[];J[ae.day]=ag}ag.push(ae)}else{if(d.BEHAVIOUR.indexOf(ae.type)>=0){var ad=N[ae.day];if(!ad){ad=[af,0];N[ae.day]=ad}if(ae.rscore<0){D+=1}ad[1]+=ae.rscore;var ag=I[ae.day];if(!ag){ag=[];I[ae.day]=ag}ag.push(ae)}}}}}});var Z=E.length;var C=M.length||1;var A=X.length;var H=O.length;L=A-L;B=H-B;var W,V,U,T,R="";if(Z>0){W="  ("+Math.round(F*100/Z)+"%)";V="  ("+Math.round(G*100/Z)+"%)";U="  ("+Math.round(B*100/H)+"%)";T="  ("+Math.round(L*100/A)+"%)";R="  ("+Math.round(D*100/Z)+"%)"}$("#fa-total").html(F+W);$("#re-total").html(G+V);$("#casa-total").html(L+T);$("#classe-total").html(B+U);$("#comportament-total").html(D+R);$("#calendar_faltes").css("height",200*C+"px");$("#calendar_classe").css("height",200*C+"px");$("#calendar_deures").css("height",200*C+"px");$("#calendar_comportament").css("height",200*C+"px");s("calendar_faltes",x.i18n.FA+" & "+x.i18n.RE,S,null,-5,0);s("calendar_classe",x.i18n.CLASSWORK,Object.values(Q),Object.values(K),-20,20);s("calendar_deures",x.i18n.HOMEWORK,Object.values(P),Object.values(J),-20,20);s("calendar_comportament",x.i18n.BEHAVIOUR,Object.values(N),Object.values(I),-50,20)});m.listActivities(w.idUserCreator,w.idGroup,y.id,h,a).then(function(B){var A="";$.each(B,function(D,F){var E=new Date(F.dia);var C=E.getDate()+"-"+(E.getMonth()+1)+"-"+E.getFullYear();A+="<tr><td>"+F.trimestre+"</td><td>"+C+"</td><td>"+F.desc+"</td><td>"+i(F.grade)+"</td></tr>"});if(!B.length){A+='<tr><td colspan="4"><i>'+g("NOACTIVITIES")+"</i></td></tr>"}$("#tbody-activitats").html(A)});m.listComments(w.idUserCreator,y.id,w.idGroup).then(function(B){var A="";$.each(B,function(D,F){var E=new Date(F.when);var C=E.getDate()+"-"+(E.getMonth()+1)+"-"+E.getFullYear();A+="<tr><td>"+C+"</td><td>"+F.msg+"</td></tr>"});if(!B.length){A+='<tr><td colspan="4"><i>'+g("NOMESSAGES")+"</i></td></tr>"}$("#tbody-missatges").html(A)})}n(function(){$("#badgeDetailHandler").draggable()},2000);v.adjustPadding()}])});